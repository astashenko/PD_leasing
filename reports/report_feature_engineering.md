 
#  ОТЧЕТ ПО РАСЧЕТУ ФИЧЕЙ МОДЕЛИ ПО ДАННЫМ ФЕДЕРАЛЬНОГО РЕСУРСА

Фичи для модели были рассчитаны на очищенных и предобработанных данных Федерального ресурса (файл data/interm/merge_cleaned.pkl) по каждому ИНН лизингополучателя (new_lessee_inn) на текущую дату (далее по тексту «фичи фед ресурса»). 

В качестве эталонных значений для моделей по фед ресурсу используется исторический портфель АО «Компании 1», сохранённый в таблице (выборке) target-class (файл data/interm/external_pkl/target_dataset.pkl). См. «Отчет по предобработке данных» раздел «Предварительная обработка данных target-class». Фичи target-class рассчитывались для каждого приложения на дату принятия решения по сделке.

Расчет фичей для выборки target-class производится в файле src/mdm/features/feature_engineering.ipynb. Рассчитанные фичи для выборки target-class сохранены в файле data/interm/target_features.pkl.

Расчет фичей фед ресурса производится в файле src/mdm/features/feature_engineering_mdm.ipynb. Рассчитанные фичи фед ресурса сохранены в файле data/interm/features_mdm.pkl.


Ниже приведен список количественных признаков (фичей), рассчитанных для выборки target-class по данным Федерального ресурса.


**Таблица 1. Фичи target-class по данным Федерального ресурса**


|    | feature                                | Наименование                                                                                                                         |
|---:|:---------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------|
|  0 | no_contracts_total                     | Количество договоров (всех закрытых и действующих), заключенных до даты принятия решения по сделке                                   |
|  1 | no_contracts_active                    | Количество активных (действующих) договоров на дату принятия решения по сделке                                                       |
|  2 | no_transport_total                     | Количество договоров только с транспортными средствами (всех закрытых и действующих), заключенных до даты принятия решения по сделке |
|  3 | no_transp_active                       | Количество активных (действующих) договоров только с транспортными средствами на дату принятия решения по сделке                     |
|  4 | no_contracts_closed                    | Количество закрытых договоров до даты принятия решения по сделке                                                                     |
|  5 | reason_завершение                      | Количество закрытых договоров до даты принятия решения по сделке по причине завершения договора                                      |
|  6 | reason_замена/перенайм/переуступка     | Количество закрытых договоров до даты принятия решения по сделке по причине замена/перенайм/переуступка                              |
|  7 | reason_не указана                      | Количество закрытых договоров до даты принятия решения по сделке по неуказанной причине                                              |
|  8 | reason_определена цессия               | Количество закрытых договоров до даты принятия решения по сделке по причине цессии                                                   |
|  9 | reason_отмена                          | Количество закрытых договоров до даты принятия решения по сделке по причине отмены                                                   |
| 10 | reason_расторгнут                      | Количество закрытых договоров до даты принятия решения по сделке по причине расторжения                                              |
| 11 | reason_страховой случай                | Количество закрытых договоров до даты принятия решения по сделке по причине страхового случая                                        |
| 12 | reason_страховой случай (гибель/тотал) | Количество закрытых договоров до даты принятия решения по сделке по причине страхового случая (гибель/тотал)                         |
| 13 | bad_reasons_closed                     | Количество договоров c признаками плохого завершения до даты принятия решения по сделке                                              |
| 14 | good_reasons_closed                    | Количество договоров c признаками хорошего завершения до даты принятия решения по сделке                                             |
| 15 | not_determined_reasons_closed          | Количество договоров c отсутствием признаков хорошего или плохого завершения до даты принятия решения по сделке                      |
| 16 | mean_bad_reasons                       | Среднее количество закрытых договоров с отрицательным исходом до даты принятия решения по сделке                                     |
| 17 | mean_good_reasons                      | Среднее количество закрытых договоров с положительным исходом до даты принятия решения по сделке                                     |
| 18 | mean_not_determined_reasons            | Среднее количество закрытых договоров с неопределенным исходом до даты принятия решения по сделке                                    |
| 19 | no_creditors                           | Количество различных лизингодателей                                                                                                  |
| 20 | max_duration                           | Максимальная длительность закрытых договоров до даты принятия решения по сделке                                                      |
| 21 | min_duration                           | Минимальная длительность закрытых договоров до даты принятия решения по сделке                                                       |
| 22 | mean_duration                          | Средняя длительность закрытых договоров до даты принятия решения по сделке                                                           |
| 23 | contract_date_delta_first              | Разница в днях между самым первым заключенным договором в mdm до даты принятия решения по сделке                                     |
| 24 | contract_date_delta_last               | Разница в днях между последним заключенным договором в mdm до даты принятия решения                                                  |
| 25 | end_date_last                          | Разница в днях между датой самого последнего завершения в mdm до даты принятия решения                                               |
| 26 | end_date_first                         | Разница в днях между датой самого первого завершения в mdm до даты принятия решения                                                  |
  

Плохим завершением 'bad_reasons_closed' считается завершение договора со следующими заключениями:  
a.	'reason_гибель/тотал',  
b.	'reason_расторгнут',  
c.	 'reason_страховой случай (гибель/тотал)'

Хорошим завершением 'good_reasons_closed' считается завершение договора с заключением:
a.	'reason_завершение',

Остальные договоры относятся к неопределенному завершению 'not_determined_reasons_closed’, то есть имеют следующие признаки завершения:  
a.	 'reason_замена/перенайм/переуступка’,  
b.	 ‘reason_не указана',   
c.	'reason_определена цессия',   
d.	'reason_отмена',  
e.	'reason_страховой случай'.

Количество различных лизингодателей – ‘no_creditors’ означает количество различных ИНН лизингодателей (поле new_creditor_inn). В случае, если в отношении компаний-публикаторах введены меры ограничительного характера, и сведения о таких лицах не подлежат размещению в информационно-телекоммуникационной сети "Интернет", поле new_creditor_inn не заполнено. Это накладывает ограничение на подсчет количества и определение других лизингодателей, с которыми заключены договоры у нашего клиента. Все лизинговые компании с государственным участием будут считаться за один лизингодатель.

Статистика по рассчитанным фичам target-class для данных, входящих в выборку модели фрод дефолта, представлена в таблице 2. 

**Таблица 2. Значения по рассчитанным фичам в target-class выборки фрод дефолта**

|    | feature                                | Наименование                                                                         |   Процент null значений | min   | mean                  | max              | std                 | 25%              | 50%              | 75%              |
|---:|:---------------------------------------|:-------------------------------------------------------------------------------------|------------------------:|:------|:----------------------|:-----------------|:--------------------|:-----------------|:-----------------|:-----------------|
|  0 | no_contracts_active                    | Количество активных (действующих) договоров                                          |                    0    | 0     | 8.55     | 674              | 25.72   | 0                | 1                | 6                |
|  1 | no_transp_active                       | Количество активных (действующих) договоров только с транспортными средствами        |                    0    | 0     | 6.78      | 594              | 20.33   | 0                | 1                | 5                |
|  2 | no_contracts_total                     | Количество договоров (всех закрытых и действующих)                                   |                    0    | 0     | 12.53     | 824              | 35.22   | 0                | 2                | 9                |
|  3 | no_transport_total                     | Количество договоров только с транспортными средствами (всех закрытых и действующих) |                    0    | 0     | 9.78     | 645              | 27.97   | 0                | 2                | 7                |
|  4 | no_contracts_closed                    | Количество закрытых договоров                                                        |                    0    | 0     | 3.97     | 276              | 13.12   | 0                | 0                | 2                |
|  5 | reason_гибель/тотал                    | Количество закрытых договоров по причине гибель/тотал                                |                    0    | 0     | 0.0013  | 2                | 0.037 | 0                | 0                | 0                |
|  6 | reason_завершение                      | Количество закрытых договоров по причине завершения договора                         |                    0    | 0     | 1.36   | 141              | 6.09   | 0                | 0                | 0                |
|  7 | reason_замена/перенайм/переуступка     | Количество закрытых договоров по причине замена/перенайм/переуступка                 |                    0    | 0     | 0.0003 | 6                | 0.026 | 0                | 0                | 0                |
|  8 | reason_не указана                      | Количество закрытых договоров по неуказанной причине                                 |                    0    | 0     | 1.88     | 195              | 7.51  | 0                | 0                | 1                |
|  9 | reason_определена цессия               | Количество закрытых договоров по причине цессии                                      |                    0    | 0     | 0.017   | 52               | 0.39  | 0                | 0                | 0                |
| 10 | reason_отмена                          | Количество закрытых договоров по причине отмены                                      |                    0    | 0     | 0.51    | 103              | 2.50  | 0                | 0                | 0                |
| 11 | reason_расторгнут                      | Количество закрытых договоров по причине расторжения                                 |                    0    | 0     | 0.15    | 31               | 1.11 | 0                | 0                | 0                |
| 12 | reason_страховой случай                | Количество закрытых договоров по причине страхового случая                           |                    0    | 0     | 0.03   | 15               | 0.31  | 0                | 0                | 0                |
| 13 | reason_страховой случай (гибель/тотал) | Количество закрытых договоров по причине страхового случая (гибель/тотал)            |                    0    | 0     | 0.0006 | 1                | 0.025 | 0                | 0                | 0                |
| 14 | bad_reasons_closed                     | Количество договоров c признаками плохого завершения                                 |                    0    | 0     | 0.15    | 31               | 1.11   | 0                | 0                | 0                |
| 15 | good_reasons_closed                    | Количество договоров c признаками хорошего завершения                                |                    0    | 0     | 1.36    | 141              | 6.09  | 0                | 0                | 0                |
| 16 | not_determined_reasons_closed          | Количество договоров с неопределенным завершением                                    |                    0    | 0     | 2.45   | 223              | 8.80   | 0                | 0                | 1                |
| 17 | mean_bad_reasons                       | Среднее количество закрытых договоров с отрицательным исходом                        |                    0    | 0     | 0.018   | 1                | 0.10  | 0                | 0                | 0                |
| 18 | mean_good_reasons                      | Среднее количество закрытых договоров с положительным исходом                        |                    0    | 0     | 0.13    | 1                | 0.29  | 0                | 0                | 0                |
| 19 | mean_not_determined_reasons            | Среднее количество закрытых договоров с неопределенным исходом                       |                    0    | 0     | 0.23    | 1                | 0.38   | 0                | 0                | 0.5              |
| 20 | no_creditors                           | Количество различных лизингодателей                                                  |                    0    | 0     | 1.72     | 24               | 2.01   | 0                | 1                | 2                |
| 21 | duration_max                           | Максимальная длительность закрытых договоров                                         |                   60.39 | 0days | 1 years  362days      | 7 years  86days  | 1 years  13days     | 1 years  37days  | 2 years  0days   | 2 years  355days |
| 22 | duration_mean                          | Средняя длительность закрытых договоров                                              |                   60.39 | 0days | 1 years  187days      | 5 years  253days | 0 years  299days    | 0 years  353days | 1 years  143days | 2 years  7days   |
| 23 | duration_min                           | Минимальная длительность закрытых договоров                                          |                   60.39 | 0days | 0 years  356days      | 5 years  253days | 0 years  327days    | 0 years  61days  | 0 years  340days | 1 years  153days |
| 24 | contract_date_delta_first              | Разница до даты заключения первого договора                                          |                   31.87 | 2days | 2 years  142days      | 20 years  37days | 1 years  213days    | 1 years  6days   | 2 years  89days  | 3 years  209days |
| 25 | contract_date_delta_last               | Разница до даты заключения последнего договора                                       |                   31.87 | 1days | 0 years  229days      | 7 years  272days | 0 years  279days    | 0 years  43days  | 0 years  121days | 0 years  308days |
| 26 | end_date_first                         | Разница до даты самого первого завершения договора                                   |                   60.39 | 0days | 1 years  297days      | 7 years  210days | 1 years  104days    | 0 years  274days | 1 years  221days | 2 years  250days |
| 27 | end_date_last                          | Разница до даты самого последнего завершения договора                                |                   60.39 | 0days | 0 years  206days      | 5 years  282days | 0 years  238days    | 0 years  43days  | 0 years  122days | 0 years  284days |



Статистика рассчитанных фичей фед ресурса представлена в таблице 3. 

**Таблица 3. Статистика рассчитанных фичей фед ресурса**

|    | feature                                | Наименование                                                                         |   Процент null значений | min   | mean                  | max                | std                 | 25%              | 50%              | 75%              |
|---:|:---------------------------------------|:-------------------------------------------------------------------------------------|------------------------:|:------|:----------------------|:-------------------|:--------------------|:-----------------|:-----------------|:-----------------|
|  0 | no_contracts_total                     | Количество договоров (всех закрытых и действующих)                                   |                    0    | 1     | 4.74      | 7192               | 23.13   | 1                | 2                | 4                |
|  1 | no_transport_total                     | Количество договоров только с транспортными средствами (всех закрытых и действующих) |                    0    | 0     | 3.60     | 7111               | 20.93   | 1                | 1                | 3                |
|  2 | no_contracts_active                    | Количество активных (действующих) договоров                                          |                    0    | 0     | 2.49     | 1775               | 11.69   | 0                | 1                | 2                |
|  3 | no_transp_active                       | Количество активных (действующих) договоров только с транспортными средствами        |                    0    | 0     | 1.81    | 1745               | 9.86    | 0                | 1                | 1                |
|  4 | no_contracts_closed                    | Количество закрытых договоров                                                        |                    0    | 0     | 2.24     | 5417               | 14.72    | 0                | 1                | 2                |
|  5 | reason_гибель/тотал                    | Количество закрытых договоров по причине гибель/тотал                                |                    0    | 0     | 0.0011  | 6                  | 0.038 | 0                | 0                | 0                |
|  6 | reason_завершение                      | Количество закрытых договоров по причине завершения договора                         |                    0    | 0     | 0.85    | 1391               | 4.83   | 0                | 0                | 1                |
|  7 | reason_замена/перенайм/переуступка     | Количество закрытых договоров по причине замена/перенайм/переуступка                 |                    0    | 0     | 0.001  | 29                 | 0.11  | 0                | 0                | 0                |
|  8 | reason_не указана                      | Количество закрытых договоров по неуказанной причине                                 |                    0    | 0     | 1.13     | 4796               | 11.50   | 0                | 0                | 1                |
|  9 | reason_определена цессия               | Количество закрытых договоров по причине цессии                                      |                    0    | 0     | 0.043    | 122                | 0.68  | 0                | 0                | 0                |
| 10 | reason_отмена                          | Количество закрытых договоров по причине отмены                                      |                    0    | 0     | 0.092   | 104                | 0.83  | 0                | 0                | 0                |
| 11 | reason_расторгнут                      | Количество закрытых договоров по причине расторжения                                 |                    0    | 0     | 0.07   | 207                | 0.88  | 0                | 0                | 0                |
| 12 | reason_страховой случай                | Количество закрытых договоров по причине страхового случая                           |                    0    | 0     | 0.048   | 135                | 0.49  | 0                | 0                | 0                |
| 13 | reason_страховой случай (гибель/тотал) | Количество закрытых договоров по причине страхового случая (гибель/тотал)            |                    0    | 0     | 0.0001 | 1                  | 0.01 | 0                | 0                | 0                |
| 14 | bad_reasons_closed                     | Количество договоров c признаками плохого завершения                                 |                    0    | 0     | 0.07   | 207                | 0.88  | 0                | 0                | 0                |
| 15 | good_reasons_closed                    | Количество договоров c признаками хорошего завершения                                |                    0    | 0     | 0.85   | 1391               | 4.83   | 0                | 0                | 1                |
| 16 | not_determined_reasons_closed          | Количество договоров с неопределенным завершением                                    |                    0    | 0     | 1.32     | 4796               | 11.73 | 0                | 0                | 1                |
| 17 | mean_bad_reasons                       | Среднее количество закрытых договоров с отрицательным исходом                        |                    0    | 0     | 0.016   | 1                  | 0.11  | 0                | 0                | 0                |
| 18 | mean_good_reasons                      | Среднее количество закрытых договоров с положительным исходом                        |                    0    | 0     | 0.25    | 1                  | 0.40  | 0                | 0                | 0.5              |
| 19 | mean_not_determined_reasons            | Среднее количество закрытых договоров с неопределенным исходом                       |                    0    | 0     | 0.34    | 1                  | 0.44  | 0                | 0                | 1                |
| 20 | no_creditors                           | Количество различных лизингодателей                                                  |                    0    | 1     | 1.47      | 26                 | 1.06   | 1                | 1                | 2                |
| 21 | duration_max                           | Максимальная длительность закрытых договоров                                         |                   38.07 | 0days | 2 years  95days       | 52 years  157days  | 1 years  8days      | 1 years  141days | 2 years  51days  | 3 years  4days   |
| 22 | duration_mean                          | Средняя длительность закрытых договоров                                              |                   38.07 | 0days | 2 years  5days        | 21 years  7days    | 0 years  337days    | 1 years  67days  | 1 years  359days | 2 years  320days |
| 23 | duration_min                           | Минимальная длительность закрытых договоров                                          |                   38.07 | 0days | 1 years  273days      | 21 years  7days    | 1 years  11days     | 0 years  364days | 1 years  244days | 2 years  281days |
| 24 | contract_date_delta_first              | Разница до даты заключения первого договора                                          |                    0.32 | 9days | 3 years  88days       | 56 years  18days   | 1 years  240days    | 2 years  1days   | 2 years  364days | 4 years  145days |
| 25 | contract_date_delta_last               | Разница до даты заключения последнего договора                                       |                    0.32 | 9days | 2 years  94days       | 21 years  16days   | 1 years  211days    | 0 years  362days | 1 years  360days | 3 years  51days  |
| 26 | end_date_first                         | Разница до даты самого первого завершения договора                                   |                   38.07 | 1days | 2 years  26days       | 270 years  254days | 1 years  348days    | 0 years  289days | 1 years  251days | 3 years  84days  |
| 27 | end_date_last                          | Разница до даты самого последнего завершения договора                                |                   38.07 | 1days | 1 years  123days      | 8 years  223days   | 1 years  86days     | 0 years  146days | 0 years  339days | 1 years  325days |


Видно, что по многим фичам статистика target-class и фед ресурса различается существенно, что требует анализа распределения и стабильности фичей.

