 
# ОТЧЕТ ПО АНАЛИЗУ СТАБИЛЬНОСТИ ФИЧЕЙ ВО ВРЕМЕНИ

 
## Постановка задачи

Необходимо определить стабильность распределений обучающей выборки target-class и фичей по данным фед. ресурса MDM во времени.

Анализ стабильности проведен в файле feature_distribution_stability.ipynb.

В качестве исходных данных использовались:
-	предобработанные данные MDM таблиц (файл data/interm/merge_cleaned.pkl)  
-	рассчитанные фичи target-class (файл data/interm/target_features.pkl), содержащие данные АО «Компания 1» c 01 января 2020 года для фрод дефолта.

 
## Расчет PSI (индекс стабильности популяции) 

Индекс PSI может использоваться для изучения сходства/различия между выборками. Общая формула для расчета PSI:

$PSI=\sum_{bin=1}^{n\_bins} {(\%Actual-\%Expected) * ln(\frac{\%Actual}{\%Expected})}$ ,   
где в нашем случае Actual – обучающая выборка target-class, Expected – выборка MDM.

PSI определяет степень различий в распределениях:
- <0.1 – незначительные изменения
- 0.1-0.2 – некоторые несущественные изменения
- 0.25 – значительные изменения
  
Предварительно значения фичей разбиваются на бины (bin) и рассчитываются проценты содержания значений в каждой группе (bin) - %Actual, %Expected. 

##  PSI обучающей выборки

В качестве базового распределения (Expected) использовались сделки с принятием решения в 2021 году, то есть с условием «Дата принятия решения по сделке» от 2021-01-01 по 2021-12-31 включительно.

В качестве Actual использовались фичи по сделкам с принятием решения от 2022-01-01 до 2023-04-01 помесячно. 

Границы каждой группы, а также проценты в полной обучающей выборке target-class в каждой группе приводятся в приложении таблице 3. При разбиении была попытка уравнять в каждом бине процентное соотношение значений, где это возможно. 

Результат сохранен в файле «data/html_report/psi_target.html». Пример для фичи no_contracts_total показан на рисунке 1.

Результат по PSI описан в столбце PSI target таблицы 1 .

<div style="text-align: center;"> 

<img src='../data/img_report/no_contracts_total psi.png'> 

**Рисунок 1. PSI фичи no_contracts_total обучающей выборки**

</div>
 
**Таблица 1. Результаты анализа по стабильности фичей**

|    | feature                                | Наименование                                                                         | PSI MDM                                                                                                          | PSI target                 | Изменение статистики распределений                                                                                                                                                                                                                                              | Резолюция по репрезентативности                                                                                                                                                                                                                                                             | Решение по фиче                                                                                                                                                            |
|---:|:---------------------------------------|:-------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------|:---------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  0 | no_contracts_total                     | Количество договоров (всех закрытых и действующих)                                   | Стабильное распределение                                                                                         | Стабильное распределение   | Среднее значение увеличивается со временем, что отражает бизнес смысл фичи. За год среднее увеличивается на 1 договор. Среднее в MDM выше, чем в обучающей выборке на 1 договор. Медиана совпадает на сегодняшний день                                                          | фича репрезентативна, характер распределения сохранен, в модели значение будет более консервативно, чем в обучающей выборке target-class                                                                                                                                                    | оставлена                                                                                                                                                                  |
|  1 | no_contracts_active                    | Количество активных (действующих) договоров                                          | PSI увеличивается со временем, в течение 12 месяцев стабильно меньше 0.1                                         | Стабильное распределение   | Среднее значение увеличивается со временем, что отражает бизнес смысл фичи. За год среднее увеличивается на 1 договор. Среднее в MDM выше, чем в обучающей выборке на 2 договора. Медиана совпадает                                                                             | фича репрезентативна, характер распределения сохранен, в модели значение будет более консервативно, чем в обучающей выборке target-class                                                                                                                                                    | оставлена                                                                                                                                                                  |
|  2 | no_transport_total                     | Количество договоров только с транспортными средствами (всех закрытых и действующих) | Стабильное распределение                                                                                         | Стабильное распределение   | Среднее значение увеличивается со временем, что отражает бизнес смысл фичи. За год среднее увеличивается на 2 договора. Среднее в MDM выше, чем в обучающей выборке на 2 договора, что говорит о большем разбросе данных в МДМ, поскольку медиана совпадает на сегодняшний день | фича репрезентативна, характер распределения сохранен, в модели значение будет более консервативно, чем в обучающей выборке target-class                                                                                                                                                    | оставлена                                                                                                                                                                  |
|  3 | no_transp_active                       | Количество активных (действующих) договоров только с транспортными средствами        | PSI увеличивается со временем, в течение 12 месяцев стабильно меньше 0.1                                         | Стабильное распределение   | Среднее значение увеличивается со временем, что отражает бизнес смысл фичи. За год среднее увеличивается на 1 договор. Среднее в MDM выше, чем в обучающей выборке на 1 договора, что говорит о большем разбросе данных в МДМ, поскольку медиана совпадает на сегодняшний день  | фича репрезентативна, характер распределения сохранен, в модели значение будет более консервативно, чем в обучающей выборке target-class                                                                                                                                                    | оставлена                                                                                                                                                                  |
|  4 | no_contracts_closed                    | Количество закрытых договоров                                                        | Стабильное распределение на промежутке не более 12 месяцев.                                                      | Стабильное распределение   | Среднее значение увеличивается со временем в обучающей выборке. в MDM такой рост значительно меньше.                                                                                                                                                                            | фича репрезентативна. До 85% всех сделок в target-class и лизингополучателей в mdm имеют одинаковое значение закрытых договоров до 3х.                                                                                                                                                      | оставлена                                                                                                                                                                  |
|  5 | reason_завершение                      | Количество закрытых договоров по причине завершения договора                         | Стабильное распределение                                                                                         | Стабильное распределение   | Незначительный одинаковый рост среднего значения.                                                                                                                                                                                                                               | фича репрезентативна, распределения практически идентичны (до 85%), значение фичи будет в модели более консервативно, чем в обучающей выборке                                                                                                                                               | оставлена                                                                                                                                                                  |
|  6 | reason_замена/перенайм/переуступка     | Количество закрытых договоров по причине замена/перенайм/переуступка                 | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | распределение одинаковое. 99.8% значений имеют нулевое значение, среди тех, у которых есть закрытые договоры.                                                                                                                                                                               | оставлена                                                                                                                                                                  |
|  7 | reason_не указана                      | Количество закрытых договоров по неуказанной причине                                 | PSI увеличивается со временем, стабильно на интервале времени не более 11 месяцев.                               | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | фича репрезентативна, характер распределения сохранен, в модели значение будет более консервативно, чем в обучающей выборке target-class                                                                                                                                                    | оставлена                                                                                                                                                                  |
|  8 | reason_определена цессия               | Количество закрытых договоров по причине цессии                                      | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | фича репрезентативна, характер распределения сохранен, но в обучающей выборке значение фичи более консервативно, поэтому в модели применятся может только с учетом увеличения значения                                                                                                      | оставлена                                                                                                                                                                  |
|  9 | reason_отмена                          | Количество закрытых договоров по причине отмены                                      | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет.  Среднее в MDM выше, чем в обучающей выборке                                                                                                                                                                                                          | фича репрезентативна, характер распределения сохранен, в модели значение будет более консервативно, чем в обучающей выборке target-class                                                                                                                                                    | оставлена                                                                                                                                                                  |
| 10 | reason_расторгнут                      | Количество закрытых договоров по причине расторжения                                 | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | фича репрезентативна, распределения практически идентичны (до 99%), значение фичи будет в модели чуть более консервативно, чем в обучающей выборке                                                                                                                                          | оставлена                                                                                                                                                                  |
| 11 | reason_страховой случай                | Количество закрытых договоров по причине страхового случая                           | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | фича репрезентативна, распределения практически идентичны                                                                                                                                                                                                                                   | оставлена                                                                                                                                                                  |
| 12 | reason_страховой случай (гибель/тотал) | Количество закрытых договоров по причине страхового случая (гибель/тотал)            | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | 99.9% значений имеют нулевое значение, среди тех, у которых есть закрытые договоры.                                                                                                                                                                                                         | оставлена                                                                                                                                                                  |
| 13 | reason_гибель/тотал                    | Количество закрытых договоров по причине гибель/тотал                                | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | распределение одинаковое.  99.7% значений имеют нулевое значение, среди тех, у которых есть закрытые договоры.                                                                                                                                                                              | оставлена                                                                                                                                                                  |
| 14 | bad_reasons_closed                     | Количество договоров c признаками плохого завершения                                 | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени нет                                                                                                                                                                                                                                                        | фича репрезентативна, характер распределения сохранен, но в обучающей выборке значение фичи более консервативно, поэтому в модели применятся может только с учетом увеличения значения                                                                                                      | оставлена                                                                                                                                                                  |
| 15 | good_reasons_closed                    | Количество договоров c признаками хорошего завершения                                | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени практически нет. Среднее значение слабо увеличивается со временем, что отражает бизнес смысл фичи. Среднее  и медианное значения в MDM и обучающей выборке совпадают                                                                                       | фича репрезентативна, распределения носят схожий характер, значение фичи будет в модели более консервативно, чем в обучающей выборке                                                                                                                                                        | оставлена                                                                                                                                                                  |
| 16 | not_determined_reasons_closed          | Количество договоров с неопределенным завершением                                    | PSI увеличивается со временем, в течение 12 месяцев стабильно меньше 0.1                                         | Стабильное распределение   | Изменений во времени в МДМ нет. В обучающей выборке среднее значение слабо, но тем не менее увеличивается со временем. Среднее  и медианное значения в MDM и обучающей выборке на сегодняшний день совпадают                                                                    | фича репрезентативна, распределения носят схожий характер, значение фичи будет в модели более консервативно, чем в обучающей выборке                                                                                                                                                        | оставлена                                                                                                                                                                  |
| 17 | mean_bad_reasons                       | Среднее количество закрытых договоров с отрицательным исходом                        | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени в МДМ нет. В обучающей выборке среднее значение слабо, но тем не менее увеличивается со временем. Среднее  и медианное значения в MDM и обучающей выборке на сегодняшний день совпадают                                                                    | фича не репрезентативна, имеет различный характер распределения                                                                                                                                                                                                                             | оставлена                                                                                                                                                                  |
| 18 | mean_good_reasons                      | Среднее количество закрытых договоров с положительным исходом                        | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени в МДМ нет. В обучающей выборке среднее значение слабо, но тем не менее увеличивается со временем. Среднее в MDM меньше.  Медианные значения совпадают.                                                                                                     | фича не репрезентативна, имеет различный характер распределения                                                                                                                                                                                                                             | оставлена                                                                                                                                                                  |
| 19 | mean_not_determined_reasons            | Среднее количество закрытых договоров с неопределенным исходом                       | PSI увеличивается со временем, в течение 12 месяцев стабильно меньше 0.1                                         | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение характерно увеличивается со временем. Среднее в MDM меньше.  Медианные значения совпадают.                                                                                                      | фича не репрезентативна, имеет различный характер распределения                                                                                                                                                                                                                             | оставлена                                                                                                                                                                  |
| 20 | no_creditors                           | Количество различных лизингодателей                                                  | Стабильное распределение                                                                                         | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение характерно увеличивается со временем. Среднее в MDM меньше.  Медианные значения совпадают.                                                                                                      | фича репрезентативна, распределения практически идентичны (до 90%), значение фичи будет в модели более консервативно, чем в обучающей выборке                                                                                                                                               | оставлена                                                                                                                                                                  |
| 21 | duration_max                           | Максимальная длительность закрытых договоров                                         | PSI увеличивается со временем, стабильно на интервале времени не более 11 месяцев.                               | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем (почти в 2 раза за 2022 год). Среднее в MDM меньше в несколько раз.                                                                                            | Характер схож, но всплески распределения в target-class более равномерно кратно целым годам, чем в mdm. Можно ли будет использовать эту фичу, будет зависеть от модели и границы принятия решения. Возможно, она будет более консервативна, а может быть, наоборот потребуется ее коррекция | под вопросом, если использовать то необходимо будет переобучать модель не реже, чем раз в полгода                                                                          |
| 22 | duration_min                           | Минимальная длительность закрытых договоров                                          | PSI увеличивается со временем, стабильно на интервале времени не более 11 месяцев.                               | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем (почти в 1.5 раза за 2022 год). Среднее в MDM меньше в несколько раз.                                                                                          | Характер схож, но всплески распределения в mdm более равномерно кратно целым годам, чем в target-class. Можно ли будет использовать эту фичу, будет зависеть от модели и границы принятия решения. Возможно, она будет более консервативна, а может быть, наоборот потребуется ее коррекция | под вопросом, если использовать то необходимо будет переобучать модель не реже, чем раз в полгода                                                                          |
| 23 | duration_mean                          | Средняя длительность закрытых договоров                                              | PSI увеличивается со временем, стабильно на интервале времени не более 11 месяцев.                               | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем (почти в 1.5 раза за 2022 год). Среднее в MDM меньше в несколько раз.                                                                                          | Характер схож, но всплески распределения в mdm более равномерно кратно целым годам, чем в target-class. Можно ли будет использовать эту фичу, будет зависеть от модели и границы принятия решения. Возможно, она будет более консервативна, а может быть, наоборот потребуется ее коррекция | под вопросом, если использовать то необходимо будет переобучать модель не реже, чем раз в полгода                                                                          |
| 24 | contract_date_delta_first              | Разница до даты заключения первого договора                                          | Нестабильное распределение                                                                                       | Нестабильное распределение | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем. Среднее в MDM меньше в несколько раз.                                                                                                                         | Фичу нельзя использовать. Тестовая выборка для фичи не репрезентативна                                                                                                                                                                                                                      | исключается                                                                                                                                                                |
| 25 | contract_date_delta_last               | Разница до даты заключения последнего договора                                       | Нестабильное распределение                                                                                       | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем. Среднее в MDM меньше в несколько раз.                                                                                                                         | Фичу нельзя использовать. Тестовая выборка для фичи не репрезентативна                                                                                                                                                                                                                      | исключается                                                                                                                                                                |
| 26 | end_date_last                          | Разница до даты самого последнего завершения договора                                | Нестабильное распределение.   PSI увеличивается со временем,  стабильно на интервале времени не более 6 месяцев. | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем. Среднее в MDM меньше в несколько раз.                                                                                                                         | Фичу нельзя использовать. Тестовая выборка для фичи не репрезентативна                                                                                                                                                                                                                      | исключается                                                                                                                                                                |
| 27 | end_date_first                         | Разница до даты самого первого завершения договора                                   | Нестабильное распределение.   PSI увеличивается со временем,  стабильно на интервале времени не более 6 месяцев. | Стабильное распределение   | Изменений во времени в МДМ не значительны. В обучающей выборке среднее значение сильно увеличивается со временем. Среднее в MDM меньше в несколько раз.                                                                                                                         | Фичу нельзя использовать. Тестовая выборка для фичи не репрезентативна                                                                                                                                                                                                                      | под вопросом. В обучающей выборке фича не стабильно и нерепрезентативна, но в MDM стабильна. Можно будет использовать, если она будет более консервативной, чем в обучении |
 
##  PSI MDM фичей

PSI MDM фичей рассчитывались дважды, используя разные базовые распределения. 

В первом случае в качестве базового распределения (Expected) использовались фичи, сформированные по данным, опубликованным до 2021-12 включительно, то есть с условием new_kreditmessage_date <=2021-12-31.

В качестве Actual использовались фичи, сформированные по данным, опубликованным с 2022-01-01 по 2023-04-01 помесячно. 

Во втором случае в качестве базового распределения (Expected) использовались фичи, сформированные по данным, опубликованным до 2022-04-30 включительно, то есть с условием new_kreditmessage_date <=2022-04-30.

В качестве Actual использовались фичи, сформированные по данным, опубликованным с 2022-05-01 по 2023-04-01 помесячно. 

Использование второго расчета позволяет определить стабильность фичей на горизонте 12 месяцев. 

Границы каждой группы, а также проценты в каждой группе, используемые при расчете PSI MDM приводятся в приложении в таблице 3. При разбиении была попытка уравнять в каждом бине процентное соотношение значений, где это возможно. 

Результат сохранен в файле «data/html_report/psi_mdm.html». Пример для фичи no_contracts_total показан на рисунке 2.

Результат по PSI описан в столбце PSI MDM таблицы 1 .

<div style="text-align: center;"> 
 
<img src='../data/img_report/no_contracts_total psi mdm.png'> 

**Рисунок 2. PSI фичи MDM no_contracts_total**

</div>
 
## Анализ изменения во времени статистических данных

Отдельно проводился анализ изменения статистических данных фичей (среднее, медиана, 95% граница). 

Результат сохранен в файле «data/html_report/statistics_stability.html». Пример для фичи no_contracts_total показан на рисунке 3.

Результат анализа описан в столбце «Изменение статистики распределений» таблицы 1 .

<div style="text-align: center;"> 

<img src='../data/img_report/no_contracts_total stat over time.png'> 

**Рисунок 3. Изменение статистики во времени**

</div>

## Заключение по стабильность фичей

Заключение написано в столбце «Решение по фиче» таблицы 1. 

Итого: исключаются из дальнейшего анализа фичи:
-	«Разница до даты заключения первого договора», 
-	«Разница до даты заключения последнего договора», 
-	«Разница до даты самого последнего завершения договора»

Следующие фичи имеют менее стабильный характер, требуют переобучение не реже, чем раз в 6-11 месяцев, либо анализа коэффициентов моделей:
-	Разница до даты самого первого завершения договора 
-	Максимальная длительность закрытых договоров,
-	Минимальная длительность закрытых договоров, 
-	Средняя длительность закрытых договоров

Остальные фичи стабильны.
 
## Приложение

**Таблица 2. Используемые bins в обучающей выборке**

|    | feature                                | n_bins   | bins                                                                    | Проценты в бине                                                          |
|---:|:---------------------------------------|:---------|:------------------------------------------------------------------------|:-------------------------------------------------------------------------|
|  0 | no_contracts_total                     | 11.0     | [  0   1   2   3   4   6   8  11  16  28 824]                           | [35.37 13.88  9.36  6.52  8.88  5.38  5.47  4.92  5.08  5.14]            |
|  1 | no_contracts_active                    | 10.0     | [  0   1   2   3   4   5   7  10  18 674]                               | [42.11 16.35  9.74  6.32  4.41  5.78  4.68  5.28  5.31]                  |
|  2 | no_transport_total                     | 10.0     | [  0   1   2   3   4   6   8  12  22 645]                               | [39.57 14.85  9.51  6.46  8.35  4.88  5.9   5.43  5.05]                  |
|  3 | no_transp_active                       | 9.0      | [  0   1   2   3   4   5   8  14 594]                                   | [46.32 16.81  9.62  5.98  4.02  6.71  5.17  5.36]                        |
|  4 | no_contracts_closed                    | 7.0      | [  0   1   2   4   6  11 276]                                           | [63.07 11.11 10.32  5.03  5.27  5.2 ]                                    |
|  5 | reason_завершение                      | 5.0      | [  0   1   2   4 141]                                                   | [77.93  9.84  6.61  5.62]                                                |
|  6 | reason_замена/перенайм/переуступка     | 4.0      | [0 1 3 6]                                                               | [99.97, 0.02, 0.0]                                                       |
|  7 | reason_не указана                      | 5.0      | [  0   1   3   6 195]                                                   | [76.56 13.36  4.94  5.14]                                                |
|  8 | reason_определена цессия               | 7.0      | [ 0  1  2  3  4  6 52]                                                  | [99.43, 0.38, 0.09, 0.05, 0.03, 0.02]                                    |
|  9 | reason_отмена                          | 7.0      | [  0   1   2   3   4   5 103]                                           | [86.87  7.09  2.74  1.17  0.7   1.43]                                    |
| 10 | reason_расторгнут                      | 7.0      | [ 0  1  2  3  4  6 31]                                                  | [95.94  2.59  0.69  0.31  0.27  0.2 ]                                    |
| 11 | reason_страховой случай                | 6.0      | [ 0  1  2  3  4 14]                                                     | [98.73, 0.79, 0.26, 0.09, 0.13]                                          |
| 12 | reason_страховой случай (гибель/тотал) | 2.0      | [0 1]                                                                   | [99.97]                                                                  |
| 13 | reason_гибель/тотал                    | 3.0      | [0 1 2]                                                                 | [99.92, 0.08]                                                            |
| 14 | bad_reasons_closed                     | 5.0      | [ 0  1  2  3 31]                                                        | [95.86  2.63  0.72  0.78]                                                |
| 15 | good_reasons_closed                    | 5.0      | [  0   1   2   4 141]                                                   | [77.93  9.84  6.61  5.62]                                                |
| 16 | not_determined_reasons_closed          | 6.0      | [  0   1   2   4   7 223]                                               | [70.84 10.36  8.64  4.54  5.62]                                          |
| 17 | mean_bad_reasons                       | 6.0      | [0.   0.03 0.11 0.25 0.5  1.  ]                                         | [95.99  0.98  1.02  0.74  0.55]                                          |
| 18 | mean_good_reasons                      | 6.0      | [0.   0.18 0.33 0.5  0.6  1.  ]                                         | [79.96  2.75  3.44  3.73  3.37]                                          |
| 19 | mean_not_determined_reasons            | 5.0      | [0.   0.43 0.61 0.83 1.  ]                                              | [74.84  5.15  4.86  1.96]                                                |
| 20 | no_creditors                           | 6.0      | [ 0  1  2  3  5 24]                                                     | [30.33 35.38 16.11 12.63  5.56]                                          |
| 21 | duration_max                           | 9.0      | [   0   63  364  423  696  745 1060 1108 2641]                          | [64.91  4.98  5.08  5.02  4.92  5.07  5.02  5.  ]                        |
| 22 | duration_min                           | 9.0      | [   0   29   61   71  338  368  491  736 2078]                          | [65.    4.6   5.31  4.94  4.96  5.19  4.98  5.03]                        |
| 23 | duration_mean                          | 9.0      | [   0   62  318  374  446  578  720  910 2078]                          | [64.64  5.32  5.01  5.02  4.99  4.99  5.02  5.01]                        |
| 24 | contract_date_delta_first              | 14.0     | [   0  102  214  327  436  564  705  857 1021 1163 1302 1458 1689 7337] | [39.98  4.98  5.02  4.98  5.    5.    5.02  4.98  5.02  4.99  5.    5.01 |
| 25 |                                        |          |                                                                         | 5.  ]                                                                    |
| 26 | contract_date_delta_last               | 14.0     | [   0   17   31   49   69   95  126  166  217  282  369  500  743 2827] | [39.7   5.03  5.18  5.04  5.04  4.91  5.04  5.02  5.02  5.    5.03  4.99 |
| 27 |                                        |          |                                                                         | 5.01]                                                                    |
| 28 | end_date_last                          | 9.0      | [   0    9   34   70  119  188  290  467 2107]                          | [64.87  5.01  5.02  5.    5.06  5.01  5.02  5.02]                        |
| 29 | end_date_first                         | 9.0      | [   0   46  188  344  512  694  910 1181 2765]                          | [64.98  5.    4.99  5.01  5.01  5.    5.    5.01]                        |

 
**Таблица 3. Используемые bins при расчете PSI MDM**

|    | feature                                |   n_bins | bins                                                                                                                            | Проценты в бине                                                                                        |
|---:|:---------------------------------------|---------:|:--------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------|
|  0 | no_contracts_total                     |        9 | [   1    2    3    4    5    6    9   15 7192]                                                                                  | [45.68 18.12  9.44  5.75  3.99  6.47  5.11  5.44]                                                      |
|  1 | no_contracts_active                    |        7 | [   0    1    2    3    5    9 1775]                                                                                            | [36.36 32.05 11.67  9.01  5.7   5.2 ]                                                                  |
|  2 | no_transport_total                     |        9 | [   0    1    2    3    4    5    7   12 7111]                                                                                  | [13.15 41.81 16.19  8.03  4.86  5.55  5.28  5.14]                                                      |
|  3 | no_transp_active                       |        8 | [   0    1    2    3    4    5    9 1745]                                                                                       | [48.41 27.57  9.54  4.31  2.52  4.15  3.5 ]                                                            |
|  4 | no_contracts_closed                    |        7 | [   0    1    2    3    5    8 5417]                                                                                            | [38.28 31.87 11.27  8.54  4.66  5.37]                                                                  |
|  5 | reason_завершение                      |        7 | [   0    1    2    3    4    6 1391]                                                                                            | [46.57 31.48  9.74  4.27  3.77  4.17]                                                                  |
|  6 | reason_замена/перенайм/переуступка     |        8 | [ 0  1  2  3  4  5  9 29]                                                                                                       | [99.89, 0.07, 0.01, 0.01, 0.0, 0.01, 0.01]                                                             |
|  7 | reason_не указана                      |        6 | [   0    1    2    4    6 4796]                                                                                                 | [40.61 34.31 14.96  4.28  5.85]                                                                        |
|  8 | reason_определена цессия               |       14 | [  0   1   2   3   4   5   6   7   8   9  11  13  22 122]                                                                       | [96.73, 2.19, 0.5, 0.2, 0.13, 0.07, 0.04, 0.03, 0.03, 0.03, 0.02, 0.03, 0.02]                          |
|  9 | reason_отмена                          |        5 | [  0   1   2   3 104]                                                                                                           | [92.79  4.64  1.29  1.28]                                                                              |
| 10 | reason_расторгнут                      |        6 | [  0   1   2   3   4 207]                                                                                                       | [95.05  3.14  0.8   0.34  0.67]                                                                        |
| 11 | reason_страховой случай                |        5 | [  0   1   2   3 137]                                                                                                           | [95.18  3.59  0.7   0.53]                                                                              |
| 12 | reason_страховой случай (гибель/тотал) |        2 | [0 1]                                                                                                                           | [99.98]                                                                                                |
| 13 | reason_гибель/тотал                    |        4 | [0 1 2 6]                                                                                                                       | [99.83, 0.15, 0.02]                                                                                    |
| 14 | bad_reasons_closed                     |       10 | [  0   1   2   3   4   5   6   8  12 207]                                                                                       | [94.9   3.27  0.81  0.35  0.19  0.12  0.13  0.12  0.11]                                                |
| 15 | good_reasons_closed                    |        7 | [   0    1    2    3    4    6 1391]                                                                                            | [46.57 31.48  9.74  4.27  3.77  4.17]                                                                  |
| 16 | not_determined_reasons_closed          |        7 | [   0    1    2    3    4    7 4796]                                                                                            | [32.79 37.87 12.01  5.28  6.41  5.64]                                                                  |
| 17 | mean_bad_reasons                       |        6 | [0.   0.02 0.15 0.33 0.56 1.  ]                                                                                                 | [95.    1.    0.84  1.16  0.35]                                                                        |
| 18 | mean_good_reasons                      |       17 | [0.   0.08 0.15 0.2  0.25 0.27 0.33 0.4  0.48 0.5  0.57 0.64 0.67 0.75 0.8  0.88 1.  ]                                          | [46.98, 0.99, 0.65, 1.03, 1.29, 0.65, 3.0, 1.4, 0.01, 6.82, 1.13, 0.12, 2.71, 1.11, 1.02, 0.41]        |
| 19 | mean_not_determined_reasons            |        7 | [0.   0.25 0.44 0.5  0.67 0.86 1.  ]                                                                                            | [34.58  5.34  0.35  8.62  6.1   1.28]                                                                  |
| 20 | no_creditors                           |        5 | [ 1  2  3  4 26]                                                                                                                | [73.79 15.73  5.6   4.87]                                                                              |
| 21 | duration_max                           |       21 | [    0   284   365   386   414   504   621   705   729   745   780   917  1047  1072  1088  1099  1108  1123  1156  1444 19137] | [4.97 4.66 5.28 5.06 5.02 5.01 4.85 4.95 5.   5.19 5.01 4.91 5.01 5.  5.03 4.64 5.25 5.15 4.98 5.03]   |
| 22 | duration_min                           |       21 | [   0   61  183  281  342  364  375  391  417  505  607  699  724  742  802 1008 1067 1088 1104 1138 7672]                      | [4.3  5.68 5.   4.94 4.78 5.22 4.96 5.09 5.01 5.   4.94 5.04 4.9  5.11  5.01 4.83 5.05 5.11 5.01 5.02] |
| 23 | duration_mean                          |       21 | [   0  256  351  374  394  431  501  564  630  695  724  744  785  869  955 1049 1077 1096 1112 1188 7672]                      | [4.97 4.95 4.99 5.01 5.04 4.99 4.99 4.98 5.04 4.96 5.06 4.98 4.99 5.01  4.96 4.96 4.99 4.89 5.22 5.01] |
| 24 | contract_date_delta_first              |       11 | [    1   407   646   795   940  1083  1298  1474  1731  2095 20450]                                                             | [ 9.98  9.94  9.96 10.03 10.01 10.05 10.    9.99 10.03 10.  ]                                          |
| 25 | contract_date_delta_last               |       11 | [   1  113  283  457  592  716  850 1031 1306 1671 7673]                                                                        | [ 9.94  9.98 10.07  9.97  9.99  9.98 10.01 10.04 10.02 10.  ]                                          |
| 26 | end_date_last                          |       11 | [   0   33  103  182  243  335  457  597  822 1236 3135]                                                                        | [ 9.93 10.    9.32  9.27 11.43  9.66 10.36  9.91 10.11 10.  ]                                          |
| 27 | end_date_first                         |       11 | [    0   123   243   341   486   608   793  1041  1261  1555 98796]                                                             | [ 9.06 10.55 10.35 10.05  9.34 10.64 10.01  7.92 12.07 10.03]                                          | 
